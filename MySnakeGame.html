<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <style>
        canvas {
            border:1px solid #d3d3d3;
            background-color: #ffffff;
        }
    </style>
</head>

<body onload="startGame()">
<audio id="food">
    <source src="http://dl.dropbox.com/u/26141789/canvas/snake/food.mp3" type="audio/mp3" />
    <source src="http://dl.dropbox.com/u/26141789/canvas/snake/food.ogg" type="audio/ogg"/>
</audio>
<script type="text/javascript" src="Prays.js"></script>
<script>

    var imported = document.createElement('script');
    imported.src = 'Prays.js';
    document.head.appendChild(imported);

    var foodMusic = document.getElementById("food");
    var gameOn = true;
    var mySnake;
    var myPray;
    var ctx;
    var score = 0;
    var pray = [];

    function startGame() {
        myGameArea.start();
        mySnake = new Snake(10);
        //myPray = new Pray();
        pray.push(new Pray1());
        pray.push(new Pray2());
        pray.push(new Pray3());
        pray.push(new Pray4());
        pray.push(new Pray5());
        pray.push(new Pray6());
        myPray = pray[4];
        ctx = myGameArea.context;
    }

    var myGameArea = {
        canvas : document.createElement("canvas"),
        start : function() {
            this.canvas.width = window.innerWidth - 20 - window.innerWidth%20;
            this.canvas.height = window.innerHeight - 20 - window.innerHeight%20;
            this.context = this.canvas.getContext("2d");
            document.body.insertBefore(this.canvas, document.body.childNodes[0]);
            this.interval = setInterval(updateGameArea, 70);
        },
        clear : function() {
            this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
        },

        showMenu : function(){
            ctx.font = "30px" + " " + "Consolas";
            ctx.fillStyle = "black";
            ctx.fillText("Score: " + score, 0, 20);
        }

    }

    function getRandomColor() {
        console.log(myGameArea.canvas.width);
        var r = 255 * Math.random()|0,
                g = 255 * Math.random()|0,
                b = 255 * Math.random()|0;
        return 'rgb(' + r + ',' + g + ',' + b + ')';
    }

    function Snake(length) {
        this.length = length;
        var crawlingDirection = "E";
        this.bodyParts = [];
        this.head;

        this.getSnake = function(){
            if(!this.bodyParts.length > 0){
                this.bodyParts = this.createSnake();
            }
            this.head = this.bodyParts[0];
            return this.bodyParts;
        }

        this.getHead = function(){
            return this.bodyParts[0];
        }

        this.createSnake = function() {
            var bodyParts = new Array();
            for(var i = this.length - 1 ; i >= 0 ;  i--) {
                bodyParts.push(new SnakeBodyPart(i,0));
            }
            return bodyParts;
        }

        this.crawl = function(){
            for(var i = 0; i < this.getSnake().length; i++) {
                var snakePart = this.bodyParts[i];
                snakePart.draw();
            }
            this.updateDirection();
            this.eat();
        }

        this.eat = function(){

            if(this.getHead().x == myPray.x && this.getHead().y == myPray.y) {
                score++;

                min = Math.ceil(0);
                max = Math.floor(5);
                myPray = pray[Math.floor(Math.random() * pray.length)];

                myPray.x = Math.round(Math.random() * (myGameArea.canvas.width - 20) / 20);
                myPray.y = Math.round(Math.random() * (myGameArea.canvas.height - 20) / 20);

                this.bodyParts.unshift(new SnakeBodyPart(this.bodyParts[0].x,this.bodyParts[0].y));
                foodMusic.currentTime = 0;
                foodMusic.play();
            }
        }

        this.updateDirection = function(){
                //Update the position of the snake
                var head_x = this.head.x;
                var head_y = this.head.y;

                //Get the directions
                document.onkeydown = function(e) {
                    var key = e.keyCode;

                    if(key == 37 && crawlingDirection != "E") setTimeout(function() {
                        crawlingDirection = "W"; }, 30);
                    else if(key == 38 && crawlingDirection != "S") setTimeout(function() {crawlingDirection = "N"; }, 30);
                    else if(key == 39 && crawlingDirection != "W") setTimeout(function() {crawlingDirection = "E"; }, 30);
                    else if(key == 40 && crawlingDirection != "N") setTimeout(function() {crawlingDirection = "S"; }, 30);
                    if(key) e.preventDefault();

                }

                //Directions
                if(crawlingDirection == "E") head_x++;
                else if(crawlingDirection == "W") head_x--;
                else if(crawlingDirection == "N") head_y--;
                else if(crawlingDirection == "S") head_y++;

                //Move snake
                var tail = this.bodyParts.pop();
                tail.x = head_x;
                tail.y = head_y;
                this.bodyParts.unshift(tail);

            if (head_x >= myGameArea.canvas.width/20){
                this.getHead().x = 0;
            } else if(head_x <= -1) {
                this.getHead().x = myGameArea.canvas.width/20;

            } else if(head_y >= myGameArea.canvas.height/20) {
                this.getHead().y = 0;

            } else if(head_y <= -1) {
                this.getHead().y = myGameArea.canvas.height/20;
            }
        }
    }

    function SnakeBodyPart(x,y){
        this.x = x;
        this.y = y;
        this.color = getRandomColor();

        this.draw = function () {

            ctx.fillStyle = "white";
            ctx.fillRect(this.x*20, this.y*20, 20, 20);

            ctx.beginPath();
            ctx.fillStyle = getRandomColor();
            ctx.arc(this.x*20+10, this.y*20+10, 10, 0, Math.PI*2, false);
            ctx.fill();

            ctx.beginPath();
            ctx.fillStyle = this.color;
            ctx.arc(this.x*20+10, this.y*20+10, 6, 0, Math.PI*2, false);
            ctx.fill();

            ctx.beginPath();
            ctx.fillStyle = "white"
            ctx.arc(this.x*20+10, this.y*20+10, 2, 0, Math.PI*2, false);
            ctx.fill();

            ctx.save();
            ctx.lineWidth = 1;
            ctx.translate(this.x*20+10,this.y*20+10);
            ctx.rotate(-convertToRadians(angle));
            <!-- set the fill style -->
            //ctx.fillStyle = getRandomColor();
            //ctx.fillRect(-25,-25,20,50);
            ctx.strokeRect(-6,-6,12,12);
            ctx.restore();

            ctx.save();
            ctx.lineWidth = 0.5;
            ctx.translate(this.x*20+10,this.y*20+10);
            ctx.rotate(-convertToRadians(angle));
            <!-- set the fill style -->
            //ctx.fillStyle = getRandomColor();
            //ctx.fillRect(-25,-25,20,50);
            ctx.strokeRect(-1,-1,2,2
            );
            ctx.restore();

            ctx.save();
            ctx.lineWidth = 0.5;
            ctx.translate(this.x*20+10,this.y*20+10);
            ctx.rotate(convertToRadians(angle));
            <!-- set the fill style -->
            //ctx.fillStyle = getRandomColor();
            //ctx.fillRect(-25,-25,20,50);
            ctx.strokeRect(-8,-8,16,16);
            ctx.restore();

            ctx.save();
            ctx.lineWidth = 0.5;
            ctx.translate(this.x*20+10,this.y*20+10);
            ctx.rotate(-convertToRadians(angle));
            <!-- set the fill style -->
            //ctx.fillStyle = getRandomColor();
            //ctx.fillRect(-25,-25,20,50);
            ctx.strokeRect(-8,-8,16,16);
            ctx.restore();
        }

    }

    function component(width, height, color, x, y) {
        this.width = width;
        this.height = height;
        this.speedX = 0;
        this.speedY = 0;
        this.x = x;
        this.y = y;
        this.update = function() {
            ctx = myGameArea.context;
            ctx.fillStyle = color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
        }
        this.newPos = function() {
            this.x += this.speedX;
            this.y += this.speedY;
        }
    }

    function updateGameArea() {

        myGameArea.clear();
        if(gameOn){
            myGameArea.showMenu();
            mySnake.crawl();
            myPray.draw();
        } else {

        }


    }



    var angle = 5;
    function convertToRadians(degree) {

        return degree*(Math.PI/180);
    }

    function incrementAngle() {
        angle+=5;
        if(angle > 360) {
            angle = 0;
        }
    }


    function drawMenu() {

    }

</script>

</body>
</html>